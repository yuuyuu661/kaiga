<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>管理ページ</title>
<link rel="stylesheet" href="style.css">
<style>
  body { padding: 20px; font-family: sans-serif; }
  input, button { margin: 6px 0; padding: 6px; }

  .tabs { display: flex; gap: 10px; margin-top: 20px; }
  .tab-btn {
    padding: 6px 12px;
    border: 1px solid #000;
    background: #f7f7f7;
    cursor: pointer;
  }
  .active { background: #ddd; }

  .tab-content { display: none; margin-top: 20px; }
  .show { display: block; }
</style>
</head>
<body>

<h1>管理ページ</h1>

<!-- ▼ 管理者ログイン -->
<div id="loginArea">
  <h3>管理者パスワードを入力</h3>
  <input id="adminPass" type="password" placeholder="パスワード">
  <button onclick="login()">ログイン</button>
</div>

<!-- ▼ ログイン後パネル -->
<div id="panel" style="display:none;">

  <!-- タブ -->
  <div class="tabs">
    <div class="tab-btn active" data-tab="regTab">作品登録</div>
    <div class="tab-btn" data-tab="listTab">作品一覧</div>
    <div class="tab-btn" data-tab="rankTab">いいねランキング</div>
  </div>

  <!-- ▼ 作品登録 -->
  <div id="regTab" class="tab-content show">
    <h2>作品登録</h2>
    <input id="author" placeholder="作者名"><br>
    <input id="order" type="number" placeholder="掲示順"><br>
    <input id="image" type="file"><br>
    <button onclick="uploadPainting()">登録</button>
  </div>

  <!-- ▼ 作品一覧 -->
  <div id="listTab" class="tab-content">
    <h2>作品一覧</h2>
    <button onclick="loadList()">読み込み</button>
    <div id="list"></div>
  </div>

  <!-- ▼ ランキング -->
  <div id="rankTab" class="tab-content">
    <h2>いいねランキング</h2>
    <button onclick="loadRank()">読み込み</button>
    <div id="rank"></div>
  </div>

</div>

<script>
/* ▼ ログイン */
async function login() {
  const r = await fetch('/api/admin/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ password: adminPass.value })
  });
  if (r.ok) {
    loginArea.style.display = 'none';
    panel.style.display = 'block';
  } else {
    alert('パスワードが違います');
  }
}

/* ▼ 作品登録 */
async function uploadPainting() {
  const fd = new FormData();
  fd.append('author', author.value);
  fd.append('order', order.value);
  fd.append('image', image.files[0]);

  await fetch('/api/admin/paintings', { method: 'POST', body: fd });
  alert("登録しました！");
}

/* ▼ 作品一覧読み込み */
async function loadList() {
  const r = await fetch('/api/paintings');
  const data = await r.json();

  list.innerHTML = data
    .map(x => `
      <div>
        <b>${x.order}. ${x.author}</b><br>
        <img src="${x.imagePath}" width="150"><br>
      </div><hr>
    `)
    .join('');
}

/* ▼ ランキング読み込み */
async function loadRank() {
  const r = await fetch('/api/admin/likes/ranking');
  const data = await r.json();

  rank.innerHTML = data
    .map(x => `${x.order}. ${x.author} - ${x.likes} いいね`)
    .join("<br>");
}

/* ▼ タブ切り替え */
document.querySelectorAll(".tab-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("show"));

    btn.classList.add("active");
    document.getElementById(btn.dataset.tab).classList.add("show");
  });
});
</script>

</body>
</html>
