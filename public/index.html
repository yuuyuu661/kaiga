<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>みんなの絵画展</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <header>
    <h1>みんなの絵画展</h1>
    <nav class="tabs" id="tabs">
      <!-- Order: Exhibit, Likes/Admin, Register/Admin -->
      <button class="tab active" data-tab="exhibit">絵画展</button>
      <button class="tab" data-tab="likes" data-protected="true">いいね履歴・ランキング <span class="badge">管理</span></button>
      <button class="tab" data-tab="register" data-protected="true">絵画登録 <span class="badge">管理</span></button>
    </nav>
    <div style="margin-left:auto; display:flex; align-items:center; gap:10px;">
      <span class="muted">入場者：<span id="visitorNameDisp">未設定</span></span>
      <!-- 名前変更は削除（仕様により禁止） -->
      <button id="adminLoginBtn" class="secondary">管理者ログイン</button>
    </div>
  </header>

  <div class="wrap">
    <!-- 展示タブ -->
    <section id="panel-exhibit" class="card">
      <h2 style="margin-top:0">絵画展</h2>
      <div id="exhibitArea">
        <div id="exhibitBox" class="imgbox"><span class="muted">作品がありません</span></div>
        <!-- タイトル・作者表示は削除 -->
        <div style="display:flex; gap:8px;">
          <button id="likeBtn">いいね</button>
          <button id="nextBtn" class="secondary">次の作品</button>
        </div>
        <p class="muted" style="margin-top:8px;">一人につき各作品1回のみ「いいね」できます。</p>
      </div>
      <div id="thanks" class="thanks hidden">来てくれてありがとう！</div>
    </section>

    <!-- 履歴・ランキング（管理者のみ） -->
    <section id="panel-likes" class="card hidden">
      <h2 style="margin-top:0">いいね履歴・ランキング</h2>
      <div class="grid grid-2">
        <div>
          <h3>いいね履歴</h3>
          <div style="overflow:auto; max-height: 420px; border:1px solid #e5e7eb; border-radius:8px;">
            <table>
              <thead><tr><th>日時</th><th>ユーザー</th><th>作品</th></tr></thead>
              <tbody id="likesTable"></tbody>
            </table>
          </div>
        </div>
        <div>
          <h3>ランキング（いいね数順）</h3>
          <ol id="ranking" style="padding-left: 20px;"></ol>
          <p class="muted" id="rankingEmpty">まだ「いいね」がありません。</p>
        </div>
      </div>
    </section>

    <!-- 登録（管理者のみ） -->
    <section id="panel-register" class="card hidden">
      <h2 style="margin-top:0">絵画登録</h2>
      <p class="muted">画像ファイルだけを登録します。画像はサーバー（DB）に保存されます。</p>
      <div class="grid grid-2">
        <div>
          <label>画像ファイル（JPG/PNG）</label>
          <input id="fileInput" type="file" accept="image/*" />
          <div id="previewBox" class="imgbox" style="margin-top:12px;"><span class="muted">プレビュー</span></div>
        </div>
        <div style="display:flex; align-items:flex-end;">
          <button id="addBtn" style="width:100%;">作品を登録</button>
        </div>
      </div>
      <h3 style="margin-top:20px">登録済み作品 <span class="muted">(ドラッグ＆ドロップで並び替え、保存不要で即反映)</span></h3>
      <div id="artList" class="grid" style="grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));"></div>
    </section>

    <!-- 編集モーダル（管理） -->
    <dialog id="editModal">
      <div class="modal">
        <h2 style="margin-top:0">作品を編集</h2>
        <div style="margin-top:8px;">
          <label>画像を差し替える（任意）</label>
          <input id="editFile" type="file" accept="image/*" />
          <div id="editPreview" class="imgbox" style="margin-top:8px;"><span class="muted">現在の画像</span></div>
        </div>
        <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
          <button id="editSaveBtn">保存</button>
        </div>
        <p id="editMsg" class="muted"></p>
      </div>
    </dialog>

    <div class="footer">© 2025 みんなの絵画展 — Railway + Postgres 永続</div>
  </div>

  <!-- 名前入力モーダル（初回のみ・変更不可） -->
  <dialog id="nameModal">
    <div class="modal">
      <h2 style="margin-top:0">お名前を入力してください</h2>
      <p class="muted">展示の入場時に必要です。「いいね」履歴に表示されます。後から変更はできません。</p>
      <input id="nameInput" type="text" placeholder="例：さくら" />
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
        <button id="saveNameBtn">入場する</button>
      </div>
    </div>
  </dialog>

  <!-- 管理者ログインモーダル -->
  <dialog id="adminModal">
    <div class="modal">
      <h2 style="margin-top:0">管理者ログイン</h2>
      <input id="adminPassInput" type="password" placeholder="管理者パスワード" />
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
        <button id="adminLoginDoBtn">ログイン</button>
      </div>
      <p id="adminLoginMsg" class="muted"></p>
    </div>
  </dialog>

  <script type="module" src="/script.js"></script>
</body>
</html>
